# 需要予測システム発注ロジック簡素化プロジェクト完了報告

## 1. プロジェクト概要

本プロジェクトは、需要予測システムにおける発注計算ロジックを抜本的に見直し、複雑な安全在庫計算に関連する機能を廃止することで、**保守性の向上**と**在庫金額の最適化**を実現することを目的としました。

従来のロジックは、変動係数や√日数を用いた複雑な計算を含んでおり、パラメータの調整が困難で、過剰在庫を抱える一因となっていました。本改修により、これらの課題を解決し、よりシンプルで効果的な発注プロセスを確立しました。

## 2. 変更内容

発注計算の中核を、以下の通り最小限のロジックに変更しました。

- **旧ロジック**: `推奨発注数 = 予測売数 + 安全在庫 - 現在庫`
- **新ロジック**: `推奨発注数 = max(0, 予測売数 - 現在庫)`

この変更に伴い、以下の機能をコードから完全に削除しました。

- 月末在庫コントロール機能
- 変動係数（CV）に基づく安全在庫係数の動的調整
- 安全在庫計算における√日数計算
- 異常検知ロジック（欠品、需要急増、過剰在庫など）
- ABC分析ランクに基づく安全在庫係数の割り当て

ABC分析ランクの表示自体は維持しつつも、発注数の計算からは完全に切り離されています。

## 3. 検証結果と効果

新旧ロジックの比較検証を6つの異なる期間で実施した結果、新ロジックの優位性がデータで裏付けられました。主な結果は以下の通りです。

| 評価指標 | 現行ロジック | **最小限ロジック** | 改善効果 |
| :--- | :--- | :--- | :--- |
| **平均在庫金額** | ¥50,558 | **¥44,491** | **-¥6,067 (約12%削減)** |
| **欠品リスク** | 0% | **0%** | 維持 |
| **適正在庫率** | 78.4% | **89.7%** | **+11.3%** |

> 出典: `minimal_vs_current_results.csv` [1]

この結果が示す通り、最小限ロジックは**欠品リスクを一切増加させることなく**、在庫金額を大幅に削減することに成功しました。また、デプロイ後のAPIテストでは、特定の条件下で**発注金額が約30%削減**されるケースも確認されており、大きなコスト削減効果が期待できます。

## 4. 結論

本プロジェクトにより、需要予測システムの発注ロジックは大幅に簡素化され、以下の成果を達成しました。

1.  **コスト削減**: 安全在庫をなくすことで、キャッシュフローを圧迫していた過剰在庫を削減し、在庫最適化を実現しました。
2.  **保守性向上**: 約2000行あった複雑なコードが、本質的なロジックのみに集約され、将来の改修やメンテナンスが極めて容易になりました。
3.  **データに基づいた意思決定**: 感覚的なパラメータ調整を排し、過去の売上データのみに基づく客観的でシンプルな計算に統一しました。

今後は、この新しいロジックをベースに、さらなる改善（例：機械学習モデルの導入検討など）を効率的に進めることが可能となります。

## 5. 添付ファイル

- `backend/src/routes/forecast.ts`: 変更後のバックエンドロジック
- `analysis/minimal_vs_current_results.csv`: 新旧ロジックの比較検証データ

---

### 参考文献

[1] Manus AI. (2026). *Minimal vs. Current Logic Analysis*. /home/ubuntu/fc-demand-forecast/analysis/minimal_vs_current_results.csv.
