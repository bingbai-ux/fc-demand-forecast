# 需要予測システム設計書 - 実装状況

## Phase 1: 基盤構築（MVP）

### 1. データベース設計
| 項目 | 状態 | 備考 |
|------|------|------|
| ABC分析結果テーブル | ❌ 未実装 | 現在はリアルタイム計算のみ |
| 需要予測結果テーブル | ❌ 未実装 | 現在はリアルタイム計算のみ |
| 異常検知フラグテーブル | ❌ 未実装 | 異常検知機能自体が未実装 |

### 2. バックエンドAPI
| 項目 | 状態 | 備考 |
|------|------|------|
| ABC分析自動計算API | ⚠️ 部分実装 | ランク計算はあるが、設計書の累積構成比方式ではない |
| 需要予測計算API | ✅ 実装済み | 単純平均方式（加重移動平均は検証で精度悪化のため不採用） |
| 発注推奨計算API | ✅ 実装済み | Order-up-to方式 |
| 異常検知API | ❌ 未実装 | |

### 3. フロントエンド
| 項目 | 状態 | 備考 |
|------|------|------|
| 発注確認画面（基本版） | ✅ 実装済み | |
| 異常商品の一覧表示 | ❌ 未実装 | |
| 正常商品の一覧表示 | ✅ 実装済み | |
| 一括承認ボタン | ✅ 実装済み | |

---

## 今回実装する機能

### 設計書に基づく異常検知機能
1. **異常フラグの種類**
   - 在庫切れ（欠品中）
   - 急激な需要増加（前週比150%以上）
   - 急激な需要減少（前週比50%以下）
   - 新商品（データ不足）
   - 季節商品（特定期間のみ販売）

2. **異常検知ロジック**
   - 前週比での変動率計算
   - 在庫ゼロ検知
   - データ期間チェック（新商品判定）

3. **UI表示**
   - 異常商品を上部に表示（赤/オレンジ背景）
   - 正常商品は下部に表示（緑背景）
   - 異常理由のバッジ表示

---

## ABC分析の設計書仕様

### 累積構成比による分類
```
A: 〜50%（売上上位50%）
B: 50〜75%
C: 75〜90%
D: 90〜97%
E: 97〜100%
```

### 現在の実装（日平均売上ベース）
```javascript
if (avgDailySales >= 3) rank = 'A';
else if (avgDailySales >= 1.5) rank = 'B';
else if (avgDailySales >= 0.5) rank = 'C';
else if (avgDailySales > 0) rank = 'D';
else rank = 'E';
```

→ 設計書の累積構成比方式に変更する必要あり
