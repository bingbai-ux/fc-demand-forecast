# ゼロベースでの発注ロジック設計

## 1. 発注の本質的な目的

**唯一の目的**: 次回発注日までに欠品しないように、適切な量を発注する

## 2. 制約条件

1. **リードタイム**: 発注してから届くまでの日数（通常2-3日）
2. **発注頻度**: 仕入先ごとに異なる（週1回、週2回など）
3. **最小発注単位（ロット）**: 商品によって異なる
4. **賞味期限**: 生鮮食品は短い
5. **在庫スペース**: 限られている

## 3. 発注量の本質的な計算式

```
発注量 = 次回発注日までに売れる量 - 現在庫
```

これが最もシンプルな本質。

### 問題点
- 「次回発注日までに売れる量」は予測でしかない
- 予測が外れると欠品または過剰在庫が発生する

## 4. 予測の不確実性への対処

### 従来のアプローチ（安全在庫）
```
発注量 = 予測売数 + 安全在庫 - 現在庫
```

安全在庫 = 予測の不確実性を吸収するバッファ

### 問題点
- 安全在庫の計算が複雑（変動係数、√日数など）
- パラメータが多すぎて調整が難しい
- 結局、欠品が発生している

## 5. ゼロベースでの新しいアプローチ

### 発想の転換: 「予測」ではなく「実績ベース」で考える

**核心的な洞察**:
- 過去7日間で10個売れた商品は、次の7日間も大体10個売れる
- 複雑な計算をするより、シンプルに「先週と同じ」と考える方が実用的

### 新ロジック案: 「先週補充法」

```
発注量 = 先週の売上 - 現在庫 + バッファ
```

**バッファ**: 先週売上の20-30%程度（シンプルな固定率）

### なぜこれがベストか

1. **シンプル**: 誰でも理解できる
2. **実績ベース**: 予測モデルに頼らない
3. **自己調整**: 売上が増えれば発注も増える、減れば減る
4. **バッファ率のみ調整**: パラメータが1つだけ

## 6. さらにシンプルにする

### 究極のシンプルロジック: 「定点補充法」

**考え方**: 在庫を常に一定レベルに保つ

```
発注量 = 目標在庫 - 現在庫
目標在庫 = 先週売上 × 1.5（または2.0）
```

### メリット
- 計算が極めてシンプル
- 「目標在庫」という1つの数字だけ管理
- 欠品リスクは「1.5」を「2.0」に変えるだけで調整可能

## 7. 検証すべき3つのアプローチ

### A. 先週補充法（バッファ率方式）
```
発注量 = max(0, 先週売上 × (1 + バッファ率) - 現在庫)
バッファ率 = 0.3（30%）
```

### B. 定点補充法（目標在庫方式）
```
発注量 = max(0, 目標在庫 - 現在庫)
目標在庫 = 先週売上 × 1.5
```

### C. 最大最小法（Min-Max方式）
```
if 現在庫 < 最小在庫:
    発注量 = 最大在庫 - 現在庫
else:
    発注量 = 0

最小在庫 = 先週売上 × 0.5
最大在庫 = 先週売上 × 2.0
```

## 8. 結論

**推奨**: B. 定点補充法

理由:
1. 最もシンプル（パラメータ1つ）
2. 直感的に理解しやすい
3. 調整が容易（係数を変えるだけ）
4. 欠品と過剰在庫のバランスが取りやすい
